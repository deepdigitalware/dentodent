version: '3.8'

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    command: node backend/content-management-db.js
    environment:
      - NODE_ENV=production
      - PORT=4444
      - PGHOST=${PGHOST:-postgresql}
      - PGPORT=${PGPORT:-5432}
      - PGUSER=${PGUSER:-dentodent}
      - PGPASSWORD=${PGPASSWORD:-Deep@DOD}
      - PGDATABASE=${PGDATABASE:-dentodent}
    labels:
      - "coolify.managed=true"
    ports:
      - "4444:4444"
    networks:
      - coolify

  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    command: node backend/frontend-server.js
    labels:
      - "coolify.managed=true"
    ports:
      - "4000:4000"
    networks:
      - coolify

  admin:
    build:
      context: .
      dockerfile: Dockerfile
    command: node backend/admin-server.js
    labels:
      - "coolify.managed=true"
    ports:
      - "4001:4001"
    networks:
      - coolify

networks:
  coolify:
    external: true
